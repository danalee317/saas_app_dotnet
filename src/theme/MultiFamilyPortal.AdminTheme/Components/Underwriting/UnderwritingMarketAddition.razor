@using Data.Models

<div class="container mb-3">
  <TelerikGrid Data=@Guidance 
               Groupable="false" 
               FilterMode="GridFilterMode.None" 
               Sortable="false"
               ShowColumnMenu="false">

    <GridToolBar>
      <div class="row w-100">
        <div class="col-4">
          <div class="text-secondary mt-3"><b>Market</b></div>
        </div>
        <div class="col-8">
          <TelerikAutoComplete @bind-Value=@_newMarket 
                               Class="form-control form-control-sm w-100" 
                               ClearButton="true"
                               Data=@_markets />
        </div>
      </div>
    </GridToolBar>

    <GridColumns>
      <GridColumn Field="Category" Groupable="false">
        <Template>
          @{
            var guidance = context as Data.Models.UnderwritingGuidance;
           }
           <span>@guidance.Category.Humanize(LetterCasing.Title)</span>
        </Template>
      </GridColumn>
      <GridColumn Field="Type" Groupable="false">
        <Template>
          @{
            var guidance = context as Data.Models.UnderwritingGuidance;
           }
          <TelerikDropDownList Data="@_expenseTypes" 
                               @bind-Value="@guidance.Type"
                               Class="form-control form-control-sm w-100"
                               Id="market-cat-ed">
            <ItemTemplate Context="menu">
              @(menu.Humanize(LetterCasing.Title))
            </ItemTemplate>
            <ValueTemplate Context="menu">
              @(@menu.Humanize(LetterCasing.Title))
            </ValueTemplate>
          </TelerikDropDownList>
        </Template>
      </GridColumn>
      <GridColumn Title="Amount">
       <Template>
         @{
            var guidance = context as Data.Models.UnderwritingGuidance;
          }

         @if (guidance.Type == CostType.PerDoor)
         {
           <div class="row">
             <div class="col-5">
               <TelerikNumericTextBox Format="C"
                                      Min="0" 
                                      Step="50"
                                      Id="market-min-ed"
                                      Class="form-control form-control-sm w-100" 
                                      @bind-Value=@guidance.Min />
             </div>
            <div class="col-2">
              <div class="text-center my-3"> - </div>
            </div>

            <div class="col-5">
              <TelerikNumericTextBox Format="C" 
                                     Min=@guidance.Min 
                                     Id="market-max-ed"
                                     Step="50"
                                     Class="form-control form-control-sm w-100" 
                                     @bind-Value=@guidance.Max />
            </div>
           </div>
         }
         else if (guidance.Type == CostType.PercentOfPurchase)
         {
           <TelerikNumericTextBox @bind-Value=@guidance.Max 
                                  Format="P" 
                                  Min="0" 
                                  Max="1" 
                                  Step="0.01"
                                  Id="market-max-ed"
                                  Class="form-control form-control-sm w-100" />  
        }
         else
        {
          <TelerikNumericTextBox @bind-Value=@guidance.Max
                                 Format="C" 
                                 Min="0" 
                                 Step="50"
                                 Id="market-max-ed"
                                 Class="form-control form-control-sm w-100" />
        }
      </Template>
    </GridColumn>
   </GridColumns>
  </TelerikGrid>

  <div class="row my-3">
    <div class="col">
      <button class="btn btn-primary" @onclick=@OnAddMarket>Save</button>
    </div>
  </div>

</div>

<PortalNotification @ref="notification" />