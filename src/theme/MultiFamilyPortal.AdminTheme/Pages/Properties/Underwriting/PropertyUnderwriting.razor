@page "/admin/underwriting/property/{propertyId:guid}"
@using MultiFamilyPortal.AdminTheme.Components.Underwriting
@using MultiFamilyPortal.AdminTheme.Components.Underwriting.Wizard

@if(Property is null)
{
  <SiteTitle Title="Underwriting" />
  <TelerikLoader Type="LoaderType.ConvergingSpinner" />
}
else
{
  <SiteTitle Title=@Property.Name />
  <Animation OptionsName="Page">
   <UnderwritingSummary Property=@Property />

    <div class="row my-2">
      <div class="col-md-3 col-sm-6 offset-md-9 offset-sm-6">
        <TelerikDropDownList Data=@AvailableStatus
                             @bind-Value=@Property.Status
                             Enabled=@_editable>
          <ValueTemplate>
            @context.Humanize(LetterCasing.Title)
          </ValueTemplate>
          <ItemTemplate>
            @context.Humanize(LetterCasing.Title)
          </ItemTemplate>
        </TelerikDropDownList>
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <TelerikWizard ShowPager=@false @bind-Value=@currentIndex>
          <WizardSettings>
            <WizardStepperSettings Linear=@false />
          </WizardSettings>
          <WizardSteps>
            <WizardStep Label="@(_isSmallScreen ? null : "Property Info")"
                        IconClass="fa-duotone fa-city">
              <Content>
                <PropertyInfoWizardStep Property=@Property />
              </Content>
            </WizardStep>
            <WizardStep Label="@(_isSmallScreen ? null : "Financials")"
                        IconClass="fa-duotone fa-money-bills">
              <Content>
                <FinancialsWizardStep Property=@Property ExpensesUpdated=@OnExpensesUpdated />
              </Content>
            </WizardStep>
            <WizardStep Label="@(_isSmallScreen ? null : "Closing")"
                        IconClass="fa-duotone fa-piggy-bank">
              <Content>
                <ClosingWizardStep Property=@Property />
              </Content>
            </WizardStep>
            <WizardStep Label="@(_isSmallScreen ? null : "Rent Roll")"
                        IconClass="fa-duotone fa-list">
              <Content>
                <RentRollWizardStep Property=@Property />
              </Content>
            </WizardStep>
            <WizardStep Label="@(_isSmallScreen ? null : "Reports")"
                        IconClass="fa-duotone fa-file-chart-column">
              <Content>
                <ReportsWizardStep Property=@Property />
              </Content>
            </WizardStep>
          </WizardSteps>
          <WizardButtons>
            @if(showPrevious)
            {
              <TelerikButton ButtonType="ButtonType.Button" OnClick=@Previous>Previous</TelerikButton>
            }
            @if(showNext)
            {
              <TelerikButton ButtonType="ButtonType.Button" Primary="true" OnClick=@Next>Next</TelerikButton>
            }
            <AuthorizedPolicy Policy=@PortalPolicy.Underwriter>
              <TelerikButton Title="Update"
                             Primary="true"
                             ButtonType=@ButtonType.Button
                             OnClick=@OnUpdateProperty>
                Update
              </TelerikButton>
            </AuthorizedPolicy>
          </WizardButtons>
        </TelerikWizard>
      </div>
    </div>
  </Animation>

  @* Resize a container based on the browser size *@

<TelerikMediaQuery Media="@_mediaQuery" OnChange="@((doesMatch) => _isSmallScreen = doesMatch)"></TelerikMediaQuery>

}

<PortalNotification @ref="notification" />


