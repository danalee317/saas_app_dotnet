<TelerikGrid Data=@_rules>
  <GridColumns>
    <GridColumn Field="Market" Groupable="true">
      <Template>
        @{ var guidance = context as Data.Models.UnderwritingGuidance; }
        @if(string.IsNullOrEmpty(guidance.Market))
        {
          <span>Default</span>
        }
        else
        {
          <span>@guidance.Market</span>
        }
      </Template>
    </GridColumn>
    <GridColumn Field="Category" Groupable="false">
      <Template>
        @{ var guidance = context as Data.Models.UnderwritingGuidance; }
          <span>@guidance.Category.Humanize(LetterCasing.Title)</span>
      </Template>
    </GridColumn>
    <GridColumn Title="Amount" TextAlign=@ColumnTextAlign.Center>
      <Template>
        @{ var guidance = context as Data.Models.UnderwritingGuidance; }
        @if(guidance.Type == Data.Models.CostType.PerDoor)
        {
          if(guidance.Min == guidance.Max)
          {
            <span>@guidance.Max.ToString("C") Per Door</span>
          }
          else
          {
            <span>@guidance.Min.ToString("C") - @guidance.Max.ToString("C") Per Door</span>
          }
        }
        else if(guidance.Type == Data.Models.CostType.PercentOfPurchase)
        {
          <span>@guidance.Max.ToString("P") of Purchase</span>
        }
        else
        {
          <span>@guidance.Max.ToString("C")</span>
        }
      </Template>
    </GridColumn>
    <GridColumn Title="Total" TextAlign=@ColumnTextAlign.Center>
      <Template>
        @{ var guidance = context as Data.Models.UnderwritingGuidance; }
        @if(guidance.Type == Data.Models.CostType.PerDoor)
        {
          var min = guidance.Min * Property.Units;
          var max = guidance.Max * Property.Units;
          if(min == max)
          {
            <span>@max.ToString("C")</span>
          }
          else
          {
            <span>@min.ToString("C") - @max.ToString("C")</span>
          }
        }
        else if(guidance.Type == Data.Models.CostType.PercentOfPurchase)
        {
          var total = guidance.Max * Property.PurchasePrice;
          <span>@total.ToString("C")</span>
        }
        else
        {
          <span>@guidance.Max.ToString("C")</span>
        }
      </Template>
    </GridColumn>
    <GridCommandColumn>
      <div class="text-center">
        <GridCommandButton Primary=@true Title="Update Underwriting" OnClick=@ShowUpdateUnderwriting>Update Underwriting</GridCommandButton>
      </div>
    </GridCommandColumn>
  </GridColumns>
</TelerikGrid>


<PortalNotification @ref="_notification" />
